---
tags:
  - mobile
screen: Exercise Detail (Set Logger)
agent: "[[designer]]"
feature: "[[features/2-workout_process]]"
design_state: "[[Statuses/Finished]]"
---
# Exercise Detail (Set Logger) Screen

> **Parent Feature**: [2-workout_process.md](../features/2-workout_process.md)
> **Navigation**: See [00-app-overview.md](../features/00-app-overview.md) for complete flows

---

## Overview

### Purpose
The Exercise Detail screen is where users log sets for a specific exercise. Users see their historical performance, track today's progress with volume calculations, and can log, edit, or delete sets. The screen supports plan-based workouts with gentle accountability and provides options to skip or finish exercises.

### Context
**Entry Points:**
- From Active Workout: Tap any exercise card
- From Onboarding: Demo exercise with pre-filled sets

**Exit Points:**
- Back arrow: Returns to Active Workout (saves all logged sets)
- Skip Exercise: Marks as Skipped, returns to Active Workout
- Finish Exercise: Marks as Completed, returns to Active Workout

### Key Features (2025-01-05)
- **Volume tracking** with animated updates
- **Skip Exercise** functionality when 0 sets logged (Issue #6)
- **Plan deviation dialog** when logged < planned sets (Issue #6)
- **Plan display** as reference (not enforced) (Issue #3)
- **Pre-fill from history** (not plan) (Issue #3)
- **Celebration animation** on set logging
- **Edit/delete sets** inline

---

## Screen States

1. **First Set (Has History)** - Historical data visible, 0 sets logged today, "Skip Exercise" button
2. **Multiple Sets** - Today's sets list visible, "Finish Exercise" button
3. **Edit Mode** - Editing specific set, "Update Set" button
4. **First Time Exercise** - No history, motivational message
5. **From Plan** - Plan recommendation displayed above history

---

## Top Bar

**Configuration**: Back + Logo (standard Exercise Detail top bar)

```
[‚Üê]              Shapyfy!
```

### Specifications:
- **Height:** 56dp
- **Background:** #FFFFFF (from LightSurface)
- **Shadow:** Elevation 2dp

### Back Arrow (Left):
- Icon: Left arrow ‚Üê
- Color: #000000 (from TextOnLight)
- Size: 24dp
- Padding left: 16dp
- Tap area: 48dp √ó 48dp
- **Behavior:** Returns to Active Workout screen (non-destructive, saves all logged sets)

### Logo (Center):
- Shapyfy logo
- Height: 32dp
- Centered horizontally

---

## Content Area

- **Background:** #F3F3F8 (from LightBackground)
- **Padding:** Horizontal 16dp, Top 16dp, Bottom 24dp
- **Scrollable:** Vertical

---

## Exercise Info Card

- **Background:** #FFFFFF (from LightSurface)
- **Border radius:** 12dp
- **Padding:** 16dp
- **Margin bottom:** 16dp
- **Shadow:** Elevation 2dp

### Exercise Name:
- Text: Exercise name (e.g., "Bench Press")
- Font: 20sp / Bold
- Color: #000000 (from TextOnLight)
- Margin bottom: 12dp

---

### Plan Progress Indicator (When from Workout Plan - Redesigned)

**Shown above historical data when `exercise.isFromPlan = true`:**

**Purpose:** Simple progress indicator showing planned set count and completion status. Values shown contextually per-set in the input card (see "Per-Set Plan Suggestion" below).

**Container:**
- Background: Transparent (minimal, inline with exercise name)
- Margin bottom: 8dp

**Layout (Horizontal):**

```
üìã 3 sets planned                         (0/3)
```

**Icon:**
- Icon: üìã (clipboard emoji) OR Material Symbol `assignment`
- Size: 16dp
- Color: #A8E6CF (LimeGreenDark - plan accent)
- Margin right: 6dp

**Text (Left):**
- Text format: "[X] sets planned"
- Example: "3 sets planned"
- Font: 14sp / Medium
- Color: #666666 (TextOnLightTertiary)

**Progress Badge (Right):**
- Text format: "([logged]/[planned])"
- Example: "(0/3)" ‚Üí "(1/3)" ‚Üí "(2/3)" ‚Üí "(3/3)"
- Font: 14sp / Medium
- Color: #666666 (default) ‚Üí #A8E6CF (when complete: logged >= planned)
- Alignment: Right

**Progress States:**

| State | Display | Color |
|-------|---------|-------|
| 0 logged | "(0/3)" | #666666 (gray) |
| Partial | "(2/3)" | #666666 (gray) |
| Complete | "(3/3) ‚úì" | #A8E6CF (green) |
| Exceeded | "(4/3) ‚úì" | #A8E6CF (green) |

**Animation:**
- Progress badge pulses briefly (scale 1.0 ‚Üí 1.1 ‚Üí 1.0, 200ms) when set logged
- Checkmark fades in when complete (opacity 0 ‚Üí 1, 200ms)

**Why Simplified:**
- Less cognitive load (just count, not values)
- Values shown contextually per-set in input card
- User sees "big picture" at a glance without clutter

---

### Historical Data (When Available)

**Last Workout Header:**
- Text format: "Last trained: [X] days ago"
- Example: "Last trained: 3 days ago"
- Font: 14sp / Medium
- Color: #2D2D2D (from TextOnLightSecondary)
- Margin bottom: 8dp

**Set List from Last Workout (Read-only):**
Each set displays on new line:
- Text format: "Set [X]: [weight]kg √ó [reps] reps"
- Example: "Set 1: 80kg √ó 10 reps"
- Font: 14sp / Regular
- Color: #666666 (from TextOnLightTertiary)
- Line spacing: 6dp between sets

---

### First Time Exercise (No History)

**Instead of "Last trained" header:**
- Text: "üéâ First time doing this exercise!"
- Font: 14sp / Regular
- Color: #A8E6CF (from LimeGreenDark)
- Padding: Vertical 12dp
- Text alignment: Left

**No set list** - historical section completely hidden

---

## Volume Display Component

**Position:** Between Exercise Info Card and Today's Sets section
**Margin bottom:** 16dp

### Layout (Horizontal)

**Icon:**
- Icon: üìä chart bars emoji or Material Icon `bar_chart`
- Size: 20dp
- Margin right: 8dp
- Vertical alignment: Center with text

**Color States:**
- When volume > 0: #666666 (from TextOnLightTertiary)
- When volume = 0: #999999 (lighter, less prominent)

**Text:**
- Text format: "Volume: [X]kg"
- Font: 16sp / Medium

**Examples:**
- "Volume: 0kg"
- "Volume: 1,140kg"
- "Volume: 1,740kg"

**Color States:**
- When volume > 0: #2D2D2D (from TextOnLightSecondary)
- When volume = 0: #999999 (grayed out)

### Calculation Logic

**Formula:**
```kotlin
Volume per set = Weight (kg) √ó Reps
Total Volume = Sum of all logged sets
```

**Example:**
- Set 1: 60kg √ó 10 = 600kg
- Set 2: 60kg √ó 9 = 540kg
- Set 3: 60kg √ó 10 = 600kg
- **Total Volume: 1,740kg**

**Display Rules:**
- Rounds to whole number (no decimals)
- Always shows "kg" unit
- Updates immediately when set logged or deleted

### Animation Behavior

**When Set Logged:**
- Number animates from old value to new value
- Duration: 300ms
- Easing: Linear
- Implementation: Count-up animation

**When Set Deleted:**
- Number animates from old value to new value
- Same animation (300ms, linear)
- Can count down

**When Set Edited:**
- Recalculates volume
- Animates to new total

---

## Today's Sets Section

### Empty State (0 Sets Logged)

- **Background:** None
- **Margin bottom:** 16dp

**Header:**
- Text: "Today's Sets"
- Font: 16sp / Medium
- Color: #000000
- Margin bottom: 12dp

**Empty State Message:**
- Text: "No sets logged yet"
- Font: 14sp / Regular
- Color: #666666
- Style: Centered, italic
- Padding: Vertical 16dp

---

### With Logged Sets (1+ Sets)

**Container:**
- Background: #FFFFFF (from LightSurface)
- Border radius: 12dp
- Padding: 16dp
- Margin bottom: 16dp
- Shadow: Elevation 1dp

**Header:**
- Text: "Today's Sets"
- Font: 16sp / Medium
- Color: #000000
- Margin bottom: 12dp

**Set Item (Repeating - Horizontal layout):**

**Set Text (Left):**
- Text format: "Set [X]: [weight]kg √ó [reps] reps"
- Example: "Set 1: 80kg √ó 12 reps"
- Font: 14sp / Regular
- Color: #000000
- Padding: Vertical 8dp

**Edit Icon (Right side):**
- Icon: Pencil symbol
- Color: #A8E6CF (from LimeGreenDark)
- Size: 20dp
- Padding: 8dp (tap target)
- Margin left: 8dp
- **Behavior:** Populates input fields with this set's data, changes "Log Set" button to "Update Set"

**Delete Icon (Far right):**
- Icon: √ó or trash symbol
- Color: #FF9999 (from ErrorRed)
- Size: 20dp
- Padding: 8dp (tap target)
- Margin left: 8dp
- **Behavior:** Shows delete confirmation dialog (see below)

**Divider (Between sets):**
- Border bottom: 1dp solid #F0F0F5 (from LightGray)
- Not shown after last item

---

## Set Input Card

**Container:**
- Background: #FFFFFF (from LightSurface)
- Border radius: 12dp
- Padding: 16dp
- Margin top: 16dp
- Shadow: Elevation 2dp

### Header:
- Text: "Log Set [X]" (dynamic based on next set number)
- Example: "Log Set 1", "Log Set 2", "Log Set 3"
- Font: 16sp / Medium
- Color: #000000
- Margin bottom: 12dp

**In Edit Mode:**
- Text: "Edit Set [X]"
- Example: "Edit Set 2"

---

### Per-Set Plan Suggestion (NEW - Contextual)

**Condition:** Show when `exercise.isFromPlan == true` AND suggestion is meaningful (see rules below).

**Position:** Below header, above input fields.

**Layout:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Log Set 2                                      ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ üí° Plan: 8 reps @ 70kg            [Use]   ‚îÇ  ‚îÇ  ‚Üê Per-set suggestion
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ  ‚îÇ Weight (kg) ‚îÇ  ‚îÇ Reps        ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ     60      ‚îÇ  ‚îÇ     10      ‚îÇ              ‚îÇ  ‚Üê Pre-filled from history
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Container:**
- Background: #F0FFF4 (very light green tint - plan accent)
- Border: 1dp solid #C8E6C9 (light green border)
- Border radius: 8dp
- Padding: 10dp 12dp
- Margin bottom: 12dp

**Icon:**
- Icon: üí° (lightbulb emoji) OR Material Symbol `tips_and_updates`
- Size: 16dp
- Color: #2D7A5F (Functional Primary)
- Margin right: 6dp

**Text:**
- Text format: "Plan: [reps] reps @ [weight]kg"
- Example: "Plan: 8 reps @ 70kg"
- Font: 14sp / Regular
- Color: #2D7A5F (Functional Primary)

**[Use] Button (Right):**
- Background: #A8E6CF (LimeGreenDark)
- Text: "Use"
- Text color: #1A1A1A
- Font: 13sp / Bold
- Padding: 6dp 12dp
- Border radius: 6dp
- Position: Right side, vertically centered

**[Use] Button Tap Behavior:**
1. Fill Weight field with `exercise.plannedSets[currentSetIndex].weight`
2. Fill Reps field with `exercise.plannedSets[currentSetIndex].reps`
3. Suggestion banner fades out (opacity 1 ‚Üí 0, 150ms)
4. Quick haptic feedback (light impact)
5. Banner stays hidden for this set (user chose to use plan values)

---

### When to Show Per-Set Suggestion

**Show suggestion when:**

| Scenario | Show? | Reason |
|----------|-------|--------|
| No history, plan has values | ‚úÖ Yes | Helpful starting point |
| History exists, plan differs significantly (>20% weight or >3 reps) | ‚úÖ Yes | Plan differs from habit |
| History exists, plan matches (~same values) | ‚ùå No | Redundant, adds clutter |
| Custom exercise (not from plan) | ‚ùå No | No plan to suggest |
| User already tapped [Use] for this set | ‚ùå No | Already applied |

**"Significantly differs" threshold:**
```kotlin
fun shouldShowSuggestion(
    historyWeight: Double?,
    historyReps: Int?,
    plannedWeight: Double,
    plannedReps: Int
): Boolean {
    // No history = always show suggestion
    if (historyWeight == null || historyReps == null) return true

    // Check if plan differs significantly
    val weightDiff = abs(plannedWeight - historyWeight) / historyWeight
    val repsDiff = abs(plannedReps - historyReps)

    return weightDiff > 0.20 || repsDiff > 3  // >20% weight change OR >3 reps difference
}
```

**Rationale:**
- If plan matches history ‚Üí user will naturally do similar values, no need to clutter
- If plan differs ‚Üí user should know their plan changed (maybe progressive overload)

---

### Input Fields (Side by Side)

**Layout:** Horizontal, equal width with gap

**Weight Field (Left, 48% width):**

**Label:**
- Text: "Weight (kg)"
- Font: 12sp / Regular
- Color: #666666 (from TextOnLightTertiary)
- Margin bottom: 6dp

**Input:**
- Background: #F3F3F8 (from LightBackground)
- Text color: #000000
- Font: 18sp / Medium
- Padding: 12dp
- Border radius: 8dp
- Text alignment: Center
- Input type: Numeric keyboard
- Pre-filled value: From last workout Set N (or previous set in current workout)

---

**Reps Field (Right, 48% width, 4% margin left):**

**Label:**
- Text: "Reps"
- Font: 12sp / Regular
- Color: #666666 (from TextOnLightTertiary)
- Margin bottom: 6dp

**Input:**
- Same styling as Weight field
- Pre-filled value: From last workout Set N (or previous set in current workout)

---

### Pre-fill Priority (Updated - History First, Plan Fallback):

```kotlin
1. If current workout has logged sets: Use last logged set
2. Else if history exists for this exercise: Use history Set N
3. Else if plan has values for this set: Use plan values (helpful starting point)
4. Else: Empty (0)
```

**Logic:**
- **History first** = respects user autonomy (what they actually did)
- **Plan as fallback** = helpful for first-time exercises (not 0)
- User can always override with the values they want

**Why this changed from original:**
Original design had "Plan values are NOT used for pre-fill" ‚Äî but this caused poor UX when user had NO history. Starting from 0kg √ó 0 reps for a first-time exercise with planned values was frustrating. Plan values provide a sensible starting point.

**Implementation:**
```kotlin
fun getPreFillValues(
    setNumber: Int,
    todaysSets: List<ExerciseSet>,
    historicalSets: List<ExerciseSet>,
    plannedSets: List<PlannedSet>?  // nullable for custom exercises
): Pair<Double, Int> {
    // 1. Current workout sets (most recent)
    if (todaysSets.isNotEmpty()) {
        return todaysSets.last().let { it.weight to it.reps }
    }

    // 2. History (what user actually did before)
    if (historicalSets.size >= setNumber) {
        return historicalSets[setNumber - 1].let { it.weight to it.reps }
    }

    // 3. Plan values (fallback for first-time exercises)
    if (plannedSets != null && plannedSets.size >= setNumber) {
        return plannedSets[setNumber - 1].let { it.weight to it.reps }
    }

    // 4. Default empty
    return 0.0 to 0
}
```

---

## Action Buttons

### Primary Button - "Log Set"

**Enabled State (Default):**
- Position: Below input card
- Margin top: 16dp
- Background: #A8E6CF (from LimeGreenDark)
- Text: "Log Set"
- Text color: #1A1A1A (from TextOnLightCard)
- Font: 16sp / Bold
- Padding: Vertical 14dp
- Border radius: 12dp
- **Width: Full width** ‚Üê CRITICAL: Must span entire content width
- Shadow: Elevation 2dp

**Behavior:**
- Tap ‚Üí Saves set to local database
- Quick haptic feedback (light impact)
- Celebration animation (see below)
- New set appears in "Today's Sets" section
- Input fields update for next set
- Header updates to "Log Set [N+1]"
- Screen scrolls to show newly logged set
- Volume display animates to new total

**Disabled State (During Celebration Animation Only):**
- Background: #C1DFD1 (from LimeGreenDisabled)
- Text: "‚úì Set Logged"
- Text color: #1A1A1A (same as enabled)
- Font: 16sp / Bold (same as enabled)
- All other properties: Same as enabled state
- Duration: 800ms
- Purpose: Prevents double-logging

**Important:** Button should ONLY be disabled during the 800ms celebration animation. Do NOT disable for empty fields or other validation - button should always be enabled for tapping otherwise.

---

**In Edit Mode:**
- Text: "Update Set"
- Same styling
- **Behavior:** Saves changes to selected set, returns to log mode

---

### Secondary Button - Conditional (Issue #6)

**Button changes based on logged sets:**

---

#### When 0 Sets Logged ‚Üí "Skip Exercise" Button

- Position: Below Log Set button
- Margin top: 12dp
- Background: #E5E5E5 (from LightGray - SOLID, not transparent)
- Border: None (NOT outline style)
- Text: "Skip Exercise"
- Text color: #666666 (from TextOnLightTertiary)
- Font: 16sp / Medium
- Padding: Vertical 14dp
- Border radius: 12dp
- **Width: Full width** ‚Üê CRITICAL: Must span entire content width
- Shadow: None

**Visual Note:** This button should have a solid gray background. It should NOT use outline/border styling (that's for "Finish Exercise"). Gray = neutral, less desirable action.

**Behavior:**
- Tap ‚Üí Opens skip confirmation dialog (see below)
- After confirmation ‚Üí Marks exercise as "Skipped"
- Returns to Active Workout screen
- Exercise shows with "Skipped" state (grayed, 60% opacity)

---

#### When 1+ Sets Logged ‚Üí "Finish Exercise" Button

- Position: Below Log Set button
- Margin top: 12dp
- Background: Transparent
- Border: 2dp solid #E5E5E5 (from LightGray)
- Text: "Finish Exercise"
- Text color: #666666 (from TextOnLightTertiary)
- Font: 14sp / Medium
- Padding: Vertical 12dp
- Border radius: 8dp
- **Width: Full width** ‚Üê CRITICAL: Must span entire content width

**Behavior:**
- If exercise from workout plan AND `logged_sets < planned_sets`:
  - Opens plan deviation dialog (see below)
- Else:
  - Marks exercise as "Completed"
  - Returns to Active Workout screen
  - Exercise shows with checkmark ‚úì

---

#### In Edit Mode ‚Üí "Cancel" Button

- Position: Below Update Set button
- Margin top: 12dp
- Background: Transparent
- Text: "Cancel"
- Text color: #666666
- Font: 14sp / Regular
- Padding: Vertical 12dp

**Behavior:**
- Cancels edit mode
- Removes highlight from set list
- Returns input card to "Log Set [N+1]" state
- Clears input fields or resets to next set values

---

## Button Visual Reference (Quick Comparison)

**For developers: This table shows all button states side-by-side for easy reference**

| Button | State/Context | Background | Border | Text Color | Width | Notes |
|--------|--------------|------------|--------|------------|-------|-------|
| **Log Set** | Always (enabled) | `#A8E6CF` (solid green) | None | `#1A1A1A` | **Full width** | Primary action - always enabled |
| **Log Set** | During animation (800ms) | `#C1DFD1` (light green) | None | `#1A1A1A` | **Full width** | Shows "‚úì Set Logged" briefly |
| **Skip Exercise** | 0 sets logged | `#E5E5E5` (solid gray) | None | `#666666` | **Full width** | Secondary - neutral action |
| **Finish Exercise** | 1+ sets logged | Transparent | `2dp solid #E5E5E5` | `#666666` | **Full width** | Tertiary - outline style |
| **Update Set** | Edit mode | `#A8E6CF` (solid green) | None | `#1A1A1A` | **Full width** | Same as "Log Set" |
| **Cancel** | Edit mode | Transparent | None | `#666666` | **Full width** | Text button style |

### Visual Hierarchy Summary
1. **Most prominent** ‚Üí "Log Set" / "Update Set" (solid green, always enabled)
2. **Secondary** ‚Üí "Skip Exercise" (solid gray, less desirable)
3. **Tertiary** ‚Üí "Finish Exercise" (outline gray, least prominent)

### Critical Implementation Notes
- ‚ùå **DO NOT** disable "Log Set" button for empty/zero values
- ‚ùå **DO NOT** use green color for "Skip Exercise" or "Finish Exercise"
- ‚ùå **DO NOT** use outline style for "Skip Exercise" (only for "Finish Exercise")
- ‚úÖ **DO** make all buttons full width (not 50% or constrained)
- ‚úÖ **DO** stack buttons vertically

---

## Celebration Animation (On Set Log)

**Triggered after:** User taps "Log Set" button and set is successfully saved

**Total Duration:** ~800ms

### Phase 1: Button Animation (0-300ms)

**"Log Set" button transforms:**

**Initial State (0ms):**
- Text: "Log Set"
- Background: #A8E6CF
- Text color: #1A1A1A

**Transition (0-300ms):**
- Text changes: "Log Set" ‚Üí "‚úì Set Logged"
- Checkmark icon (‚úì) scales in from 0.5 ‚Üí 1.0
- Spring animation: DampingRatioMediumBouncy (slight bounce)
- Background remains: #A8E6CF
- Text color remains: #1A1A1A

**Haptic Feedback (at 0ms):**
- Type: Light impact
- iOS: `UIImpactFeedbackGenerator.light()`
- Android: `HapticFeedbackConstants.CONTEXT_CLICK`

**Hold State (300-800ms):**
- Button displays "‚úì Set Logged" for 500ms
- Button disabled during this time (prevents double-tap)

**Reset (800ms):**
- Text changes back: "‚úì Set Logged" ‚Üí "Log Set"
- Button returns to enabled state
- Input card header updates: "Log Set 3" ‚Üí "Log Set 4"

---

### Phase 2: Set Appears in List (200ms after button tap)

**New set fades into Today's Sets section:**

**Animation:**
- Initial opacity: 0
- Final opacity: 1
- Duration: 200ms
- Easing: Ease-out
- Optional: Slide in TranslateY -10dp ‚Üí 0dp (subtle)

---

### Phase 3: Volume Updates (Simultaneous with Phase 2)

**Volume display animates:**

**Animation:**
- Number counts up from old value to new value
- Duration: 300ms
- Easing: Linear
- Example: 1,140kg ‚Üí 1,740kg (smooth count: 1140...1200...1400...1740)

---

## Skip Exercise Confirmation Dialog (Issue #6)

**Context:** User tapped "Skip Exercise" button (0 sets logged). Confirmation prevents accidental taps.

### Dialog Overlay
- Background dim: Semi-transparent black (#000000), 50% opacity
- Full screen overlay

### Dialog Box
- Background: #FFFFFF (from LightSurface)
- Border radius: 16dp
- Padding: 24dp
- Width: 85% of screen width
- Centered horizontally and vertically
- Shadow: Elevation 8dp

**Icon (Top, centered):**
- Icon: ‚ö†Ô∏è or question mark symbol
- Color: #FFB86C (orange/warning tone - neutral)
- Size: 40dp
- Margin bottom: 16dp

**Header:**
- Text: "Skip Exercise?"
- Font: 18sp / Bold
- Color: #000000 (from TextOnLight)
- Text alignment: Center
- Margin bottom: 12dp

**Message:**
- Text format: "You haven't logged any sets for [Exercise Name] yet."
- Example: "You haven't logged any sets for Bench Press yet."
- Font: 14sp / Regular
- Color: #666666 (from TextOnLightTertiary)
- Text alignment: Center
- Line height: 20sp
- Margin bottom: 24dp

**Tone:** Neutral, informational, not judgmental

**Buttons (Horizontal layout):**

**Cancel Button (Left, 48% width):**
- Background: Transparent
- Border: 1dp solid #E5E5E5
- Text: "Cancel"
- Text color: #666666
- Font: 14sp / Medium
- Padding: Vertical 12dp
- Border radius: 8dp
- **Behavior:** Closes dialog, returns to Exercise Detail

**Skip Button (Right, 48% width, 4% margin left):**
- Background: #E5E5E5 (neutral gray, not red)
- Text: "Skip"
- Text color: #666666
- Font: 14sp / Medium
- Padding: Vertical 12dp
- Border radius: 8dp
- **Behavior:** Marks exercise as "Skipped", navigates to Active Workout

---

**2. Plan Deviation Confirmation Dialog (Issue #6 - Enhanced)**

**Context:** User tapped "Finish Exercise" with 1+ sets logged, but `logged_sets < planned_sets`. Gentle accountability check that now shows WHAT was skipped.

**Trigger Logic:**
```kotlin
if (exercise.isFromPlan && todaysSets.count < exercise.plannedSets.count) {
    showPlanDeviationDialog()
}
```

### Dialog Overlay
- Background dim: Semi-transparent black (#000000), 50% opacity
- Full screen overlay

### Dialog Box
- Background: #FFFFFF (from LightSurface)
- Border radius: 16dp
- Padding: 24dp
- Width: 85% of screen width
- Centered horizontally and vertically
- Shadow: Elevation 8dp

**Layout:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              üìã                               ‚îÇ
‚îÇ                                               ‚îÇ
‚îÇ        Finish Exercise?                       ‚îÇ
‚îÇ                                               ‚îÇ
‚îÇ      You logged 2 sets! üí™                    ‚îÇ
‚îÇ                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  ‚úì Set 1: 10 reps @ 80kg               ‚îÇ  ‚îÇ  ‚Üê Logged (green check)
‚îÇ  ‚îÇ  ‚úì Set 2: 8 reps @ 90kg                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚óã Set 3: 6 reps @ 100kg               ‚îÇ  ‚îÇ  ‚Üê Not logged (gray circle)
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                               ‚îÇ
‚îÇ  [Add Set 3]              [Finish Anyway]     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Icon (Top, centered):**
- Icon: üìã clipboard OR Material Symbol `assignment`
- Color: #A8E6CF (from LimeGreenDark - plan color, encouraging)
- Size: 40dp
- Margin bottom: 16dp

**Header:**
- Text: "Finish Exercise?"
- Font: 18sp / Bold
- Color: #000000 (from TextOnLight)
- Text alignment: Center
- Margin bottom: 12dp

**Encouragement Line:**
- Text format: "You logged [X] sets! üí™"
- Example: "You logged 2 sets! üí™"
- Font: 14sp / Medium
- Color: #000000
- Text alignment: Center
- Margin bottom: 16dp

**Tone:** Encouraging ("You logged 2 sets! üí™" = positive), not judgmental

---

**Set Progress List (NEW):**

**Container:**
- Background: #F9F9F9 (very light gray)
- Border radius: 8dp
- Padding: 12dp
- Margin bottom: 20dp

**Logged Set Item:**
- Icon: ‚úì (checkmark)
- Icon color: #A8E6CF (green)
- Icon size: 16dp
- Text: "Set [N]: [reps] reps @ [weight]kg"
- Font: 14sp / Regular
- Color: #000000
- Padding vertical: 6dp

**Skipped Set Item:**
- Icon: ‚óã (empty circle)
- Icon color: #CCCCCC (gray)
- Icon size: 16dp
- Text: "Set [N]: [planned_reps] reps @ [planned_weight]kg"
- Font: 14sp / Regular
- Color: #999999 (muted)
- Padding vertical: 6dp

**Purpose:** Shows user exactly what they completed vs what was planned, making the decision informed.

---

**Buttons (Horizontal layout):**

**Add More Sets Button (Left, 48% width - Primary):**
- Background: #A8E6CF (from LimeGreenDark)
- Text: "Add Set [N]" (dynamic: shows next set number)
- Example: "Add Set 3"
- Text color: #1A1A1A
- Font: 14sp / Bold
- Padding: Vertical 12dp
- Border radius: 8dp
- **Behavior:** Closes dialog, returns to Exercise Detail (user can add more sets)

**Finish Anyway Button (Right, 48% width, 4% margin left - Secondary):**
- Background: Transparent
- Border: 1dp solid #E5E5E5
- Text: "Finish Anyway"
- Text color: #666666
- Font: 14sp / Medium
- Padding: Vertical 12dp
- Border radius: 8dp
- **Behavior:** Marks exercise as "Completed", navigates to Active Workout

---

**Multiple Skipped Sets:**

When user logs 1 set but plan had 4:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚úì Set 1: 10 reps @ 80kg               ‚îÇ
‚îÇ  ‚óã Set 2: 10 reps @ 85kg               ‚îÇ
‚îÇ  ‚óã Set 3: 8 reps @ 90kg                ‚îÇ
‚îÇ  ‚óã Set 4: 6 reps @ 95kg                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

Button changes to: "Add Set 2" (next sequential set)

---

**3. Delete Set Confirmation Dialog**

**Context:** User tapped delete icon (√ó) on a logged set.

**Dialog Box:**
- Background: #FFFFFF
- Border radius: 16dp
- Padding: 24dp
- Width: 85% of screen width
- Centered
- Shadow: Elevation 8dp

**Header:**
- Text: "Delete this set?"
- Font: 18sp / Bold
- Color: #000000
- Margin bottom: 12dp

**Message:**
- Text: "This action cannot be undone."
- Font: 14sp / Regular
- Color: #666666
- Margin bottom: 24dp

**Buttons (Horizontal):**

**Cancel Button (Left, 48%):**
- Background: Transparent
- Border: 1dp solid #E5E5E5
- Text: "Cancel"
- Text color: #666666
- Font: 14sp / Medium
- Padding: Vertical 12dp
- Border radius: 8dp

**Delete Button (Right, 48%, 4% margin left):**
- Background: #FF9999 (from ErrorRed)
- Text: "Delete"
- Text color: #FFFFFF
- Font: 14sp / Medium
- Padding: Vertical 12dp
- Border radius: 8dp
- **Behavior:** Deletes set, updates volume display, re-numbers remaining sets

### </exercise_detail_screen>

## 4. Notes
*   **Developer Notes**:
    *   **State Management**
    ```kotlin
    data class ExerciseDetailState(
        val exercise: WorkoutExercise,
        val historicalSets: List<ExerciseSet> = emptyList(),
        val todaysSets: List<ExerciseSet> = emptyList(),
        val isEditMode: Boolean = false,
        val editingSetIndex: Int? = null,
        val totalVolume: Int = 0
    )
    ```

    *   **Volume Calculation**
    ```kotlin
    val totalVolume = todaysSets.sumOf { it.weight * it.reps }.toInt()

    val animatedVolume by animateIntAsState(
        targetValue = totalVolume,
        animationSpec = tween(durationMillis = 300, easing = LinearEasing)
    )
    ```

    *   **Pre-fill Logic**
    ```kotlin
    fun getPreFillValues(setNumber: Int): Pair<Double, Int> {
        // 1. Check current workout
        if (todaysSets.isNotEmpty()) {
            return todaysSets.last().let { it.weight to it.reps }
        }

        // 2. Check history
        if (historicalSets.size >= setNumber) {
            return historicalSets[setNumber - 1].let { it.weight to it.reps }
        }

        // 3. Default empty
        return 0.0 to 0
    }
    ```
*   **Edge Cases**:
    *   **Scenario 1: User Edits Set While Logging New Set**
    **Behavior:**
    - Cancel new set input (unsaved)
    - Switch to edit mode for selected set
    - Pre-fill input with set's current values

    *   **Scenario 2: User Deletes All Sets**
    **Behavior:**
    - Volume resets to 0kg
    - "Finish Exercise" button disappears
    - "Skip Exercise" button appears
    - Today's Sets section shows "No sets logged yet"

    *   **Scenario 3: User Navigates Away Mid-Set**
    **Behavior:**
    - Input values NOT saved (only saved sets persist)
    - Returns to Active Workout
    - Exercise stays "In Progress" (with previously logged sets)
    - When reopened, pre-fill uses last logged set
*   **Revision History**:
    *   **2025-11-26: Plan Mode Redesign (Per-Set Targets Support)**
    - **REDESIGNED**: Plan Display ‚Üí Plan Progress Indicator ("üìã 3 sets planned (0/3)")
      - Simplified from full values to just set count + progress
      - Less cognitive load, cleaner screen
    - **ADDED**: Per-Set Plan Suggestion in input card
      - Contextual suggestion based on current set being logged
      - Shows when meaningful (no history OR plan differs from history)
      - [Use] button to quick-apply plan values
    - **UPDATED**: Pre-fill logic to include plan as fallback
      - History first (user autonomy)
      - Plan values as fallback when no history (helpful starting point)
    - **ENHANCED**: Plan Deviation Dialog
      - Now shows visual checklist of completed vs skipped sets
      - User sees exactly what they're skipping (e.g., "‚óã Set 3: 6 √ó 100kg")
      - Button changed to "Add Set [N]" (specific)
    - **PURPOSE**: Support per-set targets from 5.04-target-config (pyramid, drop sets, etc.)

    *   **2025-11-07: Implementation Review & Enhanced Documentation**
    - ‚úÖ Reviewed dev team implementation against specifications
    - ‚úÖ Confirmed all button specifications are correct and comprehensive
    - Added visual comparison table showing all button states side-by-side
    - Added "CRITICAL" markers to all full-width requirements
    - Added "Critical Implementation Notes" checklist with DO/DO NOT rules
    - Created dev team feedback document: `summaries/20251107_review_exercise_detail_button_fixes.md`
    - **Verification**: 95% of implementation correct, 4 button styling issues found (all already specified in this doc)

    *   **2025-11-06: Button State Refinements**
    - Added disabled button color specification: `#C1DFD1` (LimeGreenDisabled)
    - Clarified button should ONLY be disabled during 800ms animation (not for empty fields)
    - Emphasized "Skip Exercise" button must use solid gray background (not outline)
    - Added visual notes to prevent implementation deviations

    *   **2025-01-05: Critical UX Fixes**
    - Added Skip Exercise button (0 sets) with confirmation (Issue #6)
    - Added Plan Deviation dialog for accountability (Issue #6)
    - Added Plan Display section (reference only) (Issue #3)
    - Updated pre-fill logic (history over plan) (Issue #3)

    *   **2025-01-03: Enhanced Set Logging**
    - Added Volume tracking component with animations
    - Added celebration animation on set logging
    - Enhanced layout with better information hierarchy
    - Added edit/delete functionality for logged sets

    *   **2025-01-05: Documentation Restructure**
    - Extracted from workout_process.md into dedicated file
    - Following onboarding convention (screen-centric organization)
    - All related dialogs (skip, plan deviation, delete set) now live in this file
```
